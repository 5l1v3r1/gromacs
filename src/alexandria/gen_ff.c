#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "typedefs.h"
#include "atomprop.h"
#include "poldata.h"
#include "poldata_xml.h"

int main(int argc,char *argv[]) 
{
  gmx_poldata_t pd;
  char *smname,*elem,*desc,*gt_type,*gt_old,*charge;
  char *neighbors,*vdwparams,*geometry;
  int numbonds,atomnumber;
  double polarizability,sig_pol;
  real mass;
  gmx_atomprop_t aps;
  FILE *fp;
  
  aps = gmx_atomprop_init();
  pd  = gmx_poldata_read(NULL,aps);
  fp = fopen("forcefield.itp","w");
  fprintf(fp,"; This file is generated from gentop.dat by %s\n",argv[0]);
  fprintf(fp,"; Do not edit this file!\n");
  fprintf(fp,"; This is the force field file for the Alexandria FF\n");
  fprintf(fp,"; Paul J. van Maaren and David van der Spoel\n\n");
  fprintf(fp,"[ defaults ]\n");
  fprintf(fp,"; nbfunc        comb-rule       gen-pairs       fudgeLJ fudgeQQ\n");
  fprintf(fp,"1               1               yes             1       1\n\n");

  fprintf(fp,"[ atomtypes ]\n");
  fprintf(fp,"; name      at.num  mass     charge ptype  repulsion  dispersion\n");

  gt_old = NULL;
  while ((smname = gmx_poldata_get_ffatype(pd,NULL,&elem,&desc,&gt_type,
					   NULL,&charge,&geometry,
					   &numbonds,&neighbors,
					   &polarizability,&sig_pol,
					   &vdwparams)) != NULL)
    {
      if (gmx_atomprop_query(aps,epropMass,"",elem,&mass)) 
	{
	  atomnumber = gmx_atomprop_atomnumber(aps,elem);
	  if ((NULL == gt_old) || (strcmp(gt_old,gt_type) != 0)) {
	    fprintf(fp,"%5s   %3d  %12.6f  %10.4f  A  %-s\n",
		    gt_type,atomnumber,mass,0.0,vdwparams);
	    fprintf(fp,"%5ss  %3d  %12.6f  %10.4f  S  0  0\n",
		    gt_type,0,0.0,0.0);
	  }
	  gt_old = gt_type;
	}
    }
  fclose(fp);
  
  return 0;
}
